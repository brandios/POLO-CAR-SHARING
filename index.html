<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VW Polo Car-Sharing</title>
    <style>
        /* CSS von Anna & Heiko */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .dashboard { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); margin-bottom: 30px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; }
        .stat-card .value { font-size: 2em; font-weight: bold; }
        .balance-section { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px; }
        .balance-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .balance-card { background: white; padding: 20px; border-radius: 10px; border-left: 5px solid; }
        .balance-card.anna { border-left-color: #e74c3c; }
        .balance-card.heiko { border-left-color: #3498db; }
        .chart-container { background: white; padding: 20px; border-radius: 15px; margin-bottom: 30px; }
        .chart { height: 300px; display: flex; align-items: flex-end; justify-content: space-around; gap: 40px; padding: 20px; }
        .bar-container { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 100%; max-width: 150px; border-radius: 10px 10px 0 0; position: relative; }
        .bar.anna { background: #e74c3c; }
        .bar.heiko { background: #3498db; }
        .section { background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        .add-btn { background: #667eea; color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        input, select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .debt-alert { background: #fff3cd; border-left: 5px solid #ffc107; padding: 20px; margin-top: 20px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó VW Polo Car-Sharing</h1>
            <p id="syncStatus">‚òÅÔ∏è Verbinde mit Firebase...</p>
        </div>
        
        <div class="dashboard">
            <div class="stats-grid">
                <div class="stat-card"><h3>KM-Stand</h3><div class="value" id="currentKm">-</div></div>
                <div class="stat-card"><h3>Kosten</h3><div class="value" id="totalCosts">0,00 ‚Ç¨</div></div>
                <div class="stat-card"><h3>Gesamt km</h3><div class="value" id="totalKm">-</div></div>
            </div>
            
            <div class="balance-section">
                <h2>üí∞ Salden</h2>
                <div class="balance-cards">
                    <div class="balance-card anna"><h3>Anna</h3><div class="amount" id="annaBalance">0,00 ‚Ç¨</div><p id="annaKm">0 km</p></div>
                    <div class="balance-card heiko"><h3>Heiko</h3><div class="amount" id="heikoBalance">0,00 ‚Ç¨</div><p id="heikoKm">0 km</p></div>
                </div>
                <div class="debt-alert" id="debtAlert" style="display: none;"><h3 id="debtMessage"></h3></div>
            </div>

            <div class="chart-container">
                <div class="chart">
                    <div class="bar-container"><div class="bar anna" id="annaBar" style="height: 0px;"><div id="annaBarValue" style="text-align:center; color:white;">0%</div></div><div>Anna</div></div>
                    <div class="bar-container"><div class="bar heiko" id="heikoBar" style="height: 0px;"><div id="heikoBarValue" style="text-align:center; color:white;">0%</div></div><div>Heiko</div></div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>üîÑ Kilometerst√§nde</h2>
            <table id="kmTable"><thead><tr><th>Datum</th><th>KM</th><th>Fahrer</th><th>Gefahren</th><th>Aktionen</th></tr></thead><tbody id="kmTableBody"></tbody></table>
            <div class="input-row"><input type="date" id="kmDate"><input type="number" id="kmStand" placeholder="KM-Stand"><select id="kmDriver"><option value="Anna">Anna</option><option value="Heiko">Heiko</option></select><button class="add-btn" onclick="addKmEntry()">+ Hinzuf√ºgen</button></div>
        </div>
        
        <div class="section">
            <h2>üí∂ Kosten</h2>
            <table id="costTable"><thead><tr><th>Datum</th><th>Was?</th><th>Betrag</th><th>Bezahlt</th><th>Aktionen</th></tr></thead><tbody id="costTableBody"></tbody></table>
            <div class="input-row"><input type="date" id="costDate"><input type="text" id="costDesc" placeholder="Beschreibung"><input type="number" id="costAmount" placeholder="‚Ç¨"><select id="costPaidBy"><option value="Anna">Anna</option><option value="Heiko">Heiko</option></select><button class="add-btn" onclick="addCostEntry()">+ Hinzuf√ºgen</button></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // !!! HIER DEINE DATEN AUS FIREBASE SCHRITT 1 EINSETZEN !!!
        const firebaseConfig = {
  apiKey: "AIzaSyDkfyKLQ1cI9sPVjxdnguoT95fDcHkUIMM",
  authDomain: "polo-car-sharing-02.firebaseapp.com",
  databaseURL: "https://polo-car-sharing-02-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "polo-car-sharing-02"
  storageBucket: "polo-car-sharing-02.firebasestorage.app",
  messagingSenderId: "638073894218",
  appId: "1:638073894218:web:03834fae3d54338cc67db3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dataRef = ref(db, 'polo_data_v2');

        window.kmEntries = [{ date: '2025-11-01', km: 161607, driver: 'Heiko', driven: 0 }];
        window.costEntries = [];

        window.saveToCloud = function() {
            set(dataRef, { kmEntries: window.kmEntries, costEntries: window.costEntries });
        };

        onValue(dataRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                window.kmEntries = data.kmEntries || window.kmEntries;
                window.costEntries = data.costEntries || [];
                document.getElementById('syncStatus').textContent = "‚úÖ Daten synchronisiert";
                updateKmTable(); updateCostTable(); updateDashboard();
            }
        });

        window.addKmEntry = function() {
            const date = document.getElementById('kmDate').value;
            const km = parseInt(document.getElementById('kmStand').value);
            const driver = document.getElementById('kmDriver').value;
            if(!date || !km) return alert("Bitte km und Datum pr√ºfen!");
            const driven = km - window.kmEntries[window.kmEntries.length-1].km;
            window.kmEntries.push({ date, km, driver, driven });
            window.saveToCloud();
        };

        window.addCostEntry = function() {
            const date = document.getElementById('costDate').value;
            const desc = document.getElementById('costDesc').value;
            const amount = parseFloat(document.getElementById('costAmount').value);
            const paidBy = document.getElementById('costPaidBy').value;
            if(!date || !amount) return alert("Bitte Betrag pr√ºfen!");
            window.costEntries.push({ date, desc, amount, paidBy });
            window.saveToCloud();
        };

        window.deleteKmEntry = function(i) { if(i>0 && confirm("L√∂schen?")) { window.kmEntries.splice(i,1); window.saveToCloud(); } };
        window.deleteCostEntry = function(i) { if(confirm("L√∂schen?")) { window.costEntries.splice(i,1); window.saveToCloud(); } };

        function updateKmTable() {
            document.getElementById('kmTableBody').innerHTML = window.kmEntries.map((e, i) => 
                `<tr><td>${e.date}</td><td>${e.km}</td><td>${e.driver}</td><td>${i==0?'-':e.driven+' km'}</td><td>${i==0?'-':`<button onclick="deleteKmEntry(${i})">üóëÔ∏è</button>`}</td></tr>`
            ).join('');
        }

        function updateCostTable() {
            document.getElementById('costTableBody').innerHTML = window.costEntries.map((c, i) => 
                `<tr><td>${c.date}</td><td>${c.desc}</td><td>${c.amount.toFixed(2)}‚Ç¨</td><td>${c.paidBy}</td><td><button onclick="deleteCostEntry(${i})">üóëÔ∏è</button></td></tr>`
            ).join('');
        }

        function updateDashboard() {
            const totalKm = window.kmEntries[window.kmEntries.length-1].km - 161607;
            let aKm = 0, hKm = 0;
            for(let i=1; i<window.kmEntries.length; i++) {
                if(window.kmEntries[i-1].driver === 'Anna') aKm += window.kmEntries[i].driven;
                else hKm += window.kmEntries[i].driven;
            }
            const aP = totalKm ? aKm/totalKm : 0, hP = totalKm ? hKm/totalKm : 1;
            const totalCosts = window.costEntries.reduce((sum, c) => sum + c.amount, 0);
            const aPaid = window.costEntries.filter(c => c.paidBy === 'Anna').reduce((sum, c) => sum + c.amount, 0);
            const hPaid = window.costEntries.filter(c => c.paidBy === 'Heiko').reduce((sum, c) => sum + c.amount, 0);
            
            document.getElementById('currentKm').textContent = window.kmEntries[window.kmEntries.length-1].km;
            document.getElementById('totalCosts').textContent = totalCosts.toFixed(2) + " ‚Ç¨";
            document.getElementById('totalKm').textContent = totalKm + " km";
            document.getElementById('annaBalance').textContent = (totalCosts * aP).toFixed(2) + " ‚Ç¨";
            document.getElementById('heikoBalance').textContent = (totalCosts * hP).toFixed(2) + " ‚Ç¨";
            document.getElementById('annaKm').textContent = aKm + " km (" + (aP*100).toFixed(0) + "%)";
            document.getElementById('heikoKm').textContent = hKm + " km (" + (hP*100).toFixed(0) + "%)";
            document.getElementById('annaBar').style.height = (aP * 250) + "px";
            document.getElementById('heikoBar').style.height = (hP * 250) + "px";
            document.getElementById('annaBarValue').textContent = (aP*100).toFixed(0) + "%";
            document.getElementById('heikoBarValue').textContent = (hP*100).toFixed(0) + "%";

            const diff = aPaid - (totalCosts * aP);
            if(Math.abs(diff) > 0.1) {
                document.getElementById('debtAlert').style.display = 'block';
                document.getElementById('debtMessage').textContent = diff > 0 ? `Heiko schuldet Anna ${diff.toFixed(2)}‚Ç¨` : `Anna schuldet Heiko ${Math.abs(diff).toFixed(2)}‚Ç¨`;
            } else { document.getElementById('debtAlert').style.display = 'none'; }
        }

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('kmDate').value = today;
        document.getElementById('costDate').value = today;
    </script>
</body>
</html>
